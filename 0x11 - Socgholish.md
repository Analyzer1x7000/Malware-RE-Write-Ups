<p align="center"><img src="https://github.com/Analyzer1x7000/Malware-RE-Write-Ups/assets/103800652/27ccc846-2bec-48ed-8dc8-f1d718d01ff7" width="600" height="400"></p>

# Background - SocGholish

- According to [Mandiant](https://github.com/malwareinfosec/malwareinfosec.github.io/blob/main/Web/FakeBrowserUpdates/fakebrowserupdates.md#socgholish), Socgholish was first spotted in the wild in December of 2017 as part of a fake browser update campaign.

- Depending on what browser the user is using (presumably determined by their `user-agent`), they are prompted to download and install the latest version. Here's an example:

![Pasted image 20240705160417](https://github.com/Analyzer1x7000/Malware-RE-Write-Ups/assets/103800652/41e83642-eeeb-4347-8b4e-84d3dbdd3a34)

- Originally, the payload was delivered as a `.js` file inside of a `.zip` archive, but over time, researchers began to see it being delivered in the wild as a plain `.js` file.

- Socgholish has been known to use an interesting technique to bypass detection based on string-matching. The threat actors replace characters in the file name with "lookalikes" from other languages. 

- [RedCanary](https://redcanary.com/threat-detection-report/threats/socgholish/) writes:

![Pasted image 20240705161150](https://github.com/Analyzer1x7000/Malware-RE-Write-Ups/assets/103800652/42e950b9-8d3d-4978-af08-2c414db09a88)

- [Proofpoint](https://www.proofpoint.com/us/blog/threat-insight/part-1-socgholish-very-real-threat-very-fake-update) writes that historically, the end of the attack chain has typically concluded with either Cobalt Strike or various RATs, and sometimes ransomware.

# Analysis

- After unzipping the sample and opening it in Visual Studio Code, it is visibly much smaller than a Gootloader script. This one comes in at only 76 lines of code. 

![Pasted image 20240705161553](https://github.com/Analyzer1x7000/Malware-RE-Write-Ups/assets/103800652/d5b0c62b-8b9d-4f61-aa3e-00ddb76cc350)

- It is clearly obfuscated, but not too heavily. 

- The script constructs a URL, sends HTTP POST requests, and processes the response. 

- Lastly, it uses `eval` to execute the response of the `request` function, which presumably executes the code returned by the C2 server.

![Pasted image 20240705164038](https://github.com/Analyzer1x7000/Malware-RE-Write-Ups/assets/103800652/86a8926c-f113-4555-927d-58f91a8b8a05)

![Pasted image 20240705163910](https://github.com/Analyzer1x7000/Malware-RE-Write-Ups/assets/103800652/ac065287-f534-49a6-8c2a-cade54a05e8d)

- Once de-obfuscated, the URL it communicates with is `168c39dd[.]apps.weightlossihp[.]com`.

# Summary

- This specimen is a typical Socgholish sample that arrives to the end user as a `.js` file which, when executed via `cscript`, de-obfuscates the C2 URL and begins to communicate with `168c39dd[.]apps.weightlossihp[.]com` over HTTP.
